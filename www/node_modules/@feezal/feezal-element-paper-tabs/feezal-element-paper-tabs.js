import {FeezalElement, html} from "@feezal/feezal-element";

import '@polymer/paper-tabs/paper-tabs';
import '@polymer/paper-tabs/paper-tab';

class FeezalElementPaperTabs extends FeezalElement {
    static get template() {
        return html`
            <style include="feezal-style-element">
                iframe {
                    border: var(--feezal-basic-iframe-border);
                    padding: 0;
                    margin: 0;
                    width: 100%;
                    height: 100%;
                    box-sizing: border-box;
                }
            </style>
            <paper-tabs id="tabs" selected="{{selected}}">
                <template is="dom-repeat" items="{{arrItems}}">
                    <paper-tab>{{item}}</paper-tab>
                </template>
            </paper-tabs>
            
        `;
    }
    static get properties() {
        return {
            subscribeTopic: {
                type: String,
                reflectToAttribute: true
            },
            publishTopic: {
                type: String,
                reflectToAttribute: true
            },
            publishLocal: {
                type: Boolean,
                reflectToAttribute: true
            },
            items: {
                type: String,
                value: '',
                reflectToAttribute: true,
                observer: '_itemsChanged'
            },
            arrItems: {
                type: Array
            },
            refresh: {
                type: Number,
                value: 0,
                reflectToAttribute: true
            },
            selected: {
                type: String,
                reflectToAttribute: true,
                notify: true
            }
        }
    }
    static get feezal() {
        return {
            palette: {
                category: 'Paper',
                name: 'Tabs',
                color: '#eee'
            },
            attributes: [
                'publishLocal',
                'items'
            ],
            baseAttribute: 'selected',
            styles: [
                'top',
                'left',
                'width',
                'height',
                'border',
                '--paper-tabs-selection-bar-color'
            ],
            restrict: {
                minWidth: 12,
                minHeight: 12
            }
        };
    }
    connectedCallback() {
        super.connectedCallback();
        this.$.tabs.addEventListener('selected-item-changed', e => {
            console.log('tabs', e);
            if (e.detail && e.detail.value) {
                const item = e.detail.value.innerHTML;
                feezal.connection.publish(this.publishTopic, item, {local: this.publishLocal});
            }
        })


        if (!feezal.isEditor && this.subscribeTopic) {
            feezal.connection.subscribe(this.subscribeTopic, msg => {
                this.$.tabs.selected = this.arrItems.indexOf(msg.payload);
            });
        }

    }
    _itemsChanged(items) {
        this.arrItems = items.split('/')
    }
}

window.customElements.define('feezal-element-paper-tabs', FeezalElementPaperTabs);
